<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="theme-color" content="#0FA36B"/>

<title>
  n8n on self-hosted servers to auto-cancel bot-generated warranty‑only Shopify orders | Zinus Tech Blog
</title>

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>n8n on self-hosted servers to auto-cancel bot-generated warranty‑only Shopify orders | Zinus Tech Blog</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="n8n on self-hosted servers to auto-cancel bot-generated warranty‑only Shopify orders" />
<meta name="author" content="Zinus Engineering" />
<meta property="og:locale" content="en" />
<meta name="description" content="Replacing Shopify Flow with n8n using GraphQL to cancel $0 or low‑value protection plan orders (Mulberry, Route) created by bots" />
<meta property="og:description" content="Replacing Shopify Flow with n8n using GraphQL to cancel $0 or low‑value protection plan orders (Mulberry, Route) created by bots" />
<link rel="canonical" href="http://localhost:4000/Zinus/posts/2025/09/03/n8n-shopify-anti-bot-cancellations/" />
<meta property="og:url" content="http://localhost:4000/Zinus/posts/2025/09/03/n8n-shopify-anti-bot-cancellations/" />
<meta property="og:site_name" content="Zinus Tech Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-09-03T00:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="n8n on self-hosted servers to auto-cancel bot-generated warranty‑only Shopify orders" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zinus Engineering"},"dateModified":"2025-09-03T00:00:00+09:00","datePublished":"2025-09-03T00:00:00+09:00","description":"Replacing Shopify Flow with n8n using GraphQL to cancel $0 or low‑value protection plan orders (Mulberry, Route) created by bots","headline":"n8n on self-hosted servers to auto-cancel bot-generated warranty‑only Shopify orders","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/Zinus/posts/2025/09/03/n8n-shopify-anti-bot-cancellations/"},"url":"http://localhost:4000/Zinus/posts/2025/09/03/n8n-shopify-anti-bot-cancellations/"}</script>
<!-- End Jekyll SEO tag -->


<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<link rel="icon" href="/Zinus/assets/favicon.svg" type="image/svg+xml">

<link rel="stylesheet" href="/Zinus/assets/css/main.css">

<!-- Mermaid for diagrams in posts -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
  mermaid.initialize({
    startOnLoad: false,
    theme: 'default',
    securityLevel: 'loose',
    flowchart: { htmlLabels: false }
  });
</script>



  </head>
  <body class="site">
    <a class="skip-link" href="#content">Skip to content</a>
    <header class="site-header">
  <div class="container header__inner">
    <a class="brand" href="/Zinus/" aria-label="Zinus Tech Blog">
      <span class="brand__mark">Z</span>
      <span class="brand__name">Zinus Engineering</span>
    </a>
    <button class="nav-toggle" aria-expanded="false" aria-controls="site-nav">Menu</button>
    <nav id="site-nav" class="nav" aria-label="Primary navigation">
      <ul>
        
          <li><a href="http://localhost:4000/Zinus/">Home</a></li>
        
          <li><a href="http://localhost:4000/Zinus/posts/">Posts</a></li>
        
          <li><a href="http://localhost:4000/Zinus/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</header>
<script src="/Zinus/assets/js/site.js" defer></script>



    <main id="content" class="container">
      <article class="post">
  <header class="post__header">
    <h1 class="post__title">n8n on self-hosted servers to auto-cancel bot-generated warranty‑only Shopify orders</h1>
    <div class="post__meta">
      <time datetime="2025-09-03T00:00:00+09:00">2025.09.03</time>
      
        · <span>Zinus Engineering</span>
      
    </div>
    
      <div class="post__authors">
        
          <a class="author" href="https://www.linkedin.com/in/junkukkim/" target="_blank" rel="noopener">
            
            <img class="author__avatar" src="/Zinus/assets/img/avatar-fallback.svg" alt="Junkuk Kim">
            <span class="author__meta">
              <span class="author__name">Junkuk Kim</span>
              <span class="author__role">DevOps Engineer, Zinus</span>
            </span>
          </a>
        
          <a class="author" href="https://www.linkedin.com/in/thebobhudgins/" target="_blank" rel="noopener">
            
            <img class="author__avatar" src="/Zinus/assets/img/avatar-fallback.svg" alt="Bobby Hudgins">
            <span class="author__meta">
              <span class="author__name">Bobby Hudgins</span>
              <span class="author__role">Software Engineer, Zinus</span>
            </span>
          </a>
        
      </div>
    
  </header>
  <div class="post__content">
    <p>This project documents how we built a self‑hosted n8n workflow to automatically cancel malicious orders that contain only non-public warranty products (e.g., Mulberry, Route) or low‑value $3 protection plans. Attackers were repeatedly creating these orders to pollute our sales signals and downstream operations. The workflow runs reliably in production and replaces a previous attempt with Shopify Flow.</p>

<h2 id="why-n8n-instead-of-shopify-flow">Why n8n instead of Shopify Flow</h2>

<ul>
  <li>Shopify Flow cannot cancel orders in our scenario.</li>
  <li>Our SAP integration sometimes pushes tracking first and marks orders as Fulfillment in progress, which blocks Flow from cancelling/refunding.</li>
  <li>Conflicts with Shopify’s built‑in High‑risk auto‑cancel flow created race conditions and inconsistent states.</li>
  <li>n8n lets us orchestrate retries and call Shopify GraphQL directly, including fulfillment cancellation before order cancellation.</li>
</ul>

<h2 id="highlevel-behavior">High‑level behavior</h2>

<ul>
  <li>Detect orders via Shopify <code class="language-plaintext highlighter-rouge">orders/create</code> webhook and a scheduled backfill (every 30 minutes).</li>
  <li>Inspect line items; if all items are tagged <code class="language-plaintext highlighter-rouge">SEARCHANISE_IGNORE</code>, treat the order as a warranty‑only/bot order.</li>
  <li>Attempt <code class="language-plaintext highlighter-rouge">orderCancel</code> via GraphQL.</li>
  <li>If the order has outstanding fulfillments, call <code class="language-plaintext highlighter-rouge">fulfillmentCancel</code>, wait briefly, then retry <code class="language-plaintext highlighter-rouge">orderCancel</code>.</li>
  <li>Send an operational email once handled.</li>
</ul>

<h2 id="diagram">Diagram</h2>

<pre><code class="language-mermaid">graph TD
  subgraph Triggers
    A["Shopify orders/create webhook"]
    B["Schedule trigger (every 30m), get recent orders"]
  end

  A --&gt; C["Get order"]
  B --&gt; D["Loop over recent orders"]
  D --&gt; C

  C --&gt; E["Split line items"]
  E --&gt; F["Fetch product for each item"]
  F --&gt; G{Product tags include: SEARCHANISE_IGNORE?}
  G --&gt;|yes| H["Mark item as __skip"]
  G --&gt;|no| I["Keep item"]
  H --&gt; J["Batch complete"]
  I --&gt; J

  J --&gt; K{All items skipped? warranty-only}
  K --&gt;|no| L["Do nothing"]
  K --&gt;|yes| M["GraphQL orderCancel"]

  M --&gt; N{Error: outstanding fulfillments?}
  N --&gt;|yes| O["GraphQL fulfillmentCancel"]
  O --&gt; P["Wait 1-5s"]
  P --&gt; Q["GraphQL orderCancel (retry)"]
  N --&gt;|no| R["Done"]
  Q --&gt; S{Errors remain?}
  S --&gt;|yes| T["Escalate / log"]
  S --&gt;|no| R

  R --&gt; U["Send email via Outlook node"]
</code></pre>

<h2 id="key-implementation-notes">Key implementation notes</h2>

<ul>
  <li>The workflow file in this repository shows the exact node graph: <code class="language-plaintext highlighter-rouge">Shopify - Cancel SEARCHANISE_IGNORE Only Orders.json</code>.</li>
  <li>We use Shopify GraphQL API <code class="language-plaintext highlighter-rouge">2025-07</code> with header‑auth in n8n.</li>
  <li>Core mutations:</li>
</ul>

<div class="language-graphql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">mutation</span><span class="w"> </span><span class="n">OrderCancel</span><span class="p">(</span><span class="w">
  </span><span class="nv">$orderId</span><span class="p">:</span><span class="w"> </span><span class="nb">ID</span><span class="p">!,</span><span class="w">
  </span><span class="nv">$notifyCustomer</span><span class="p">:</span><span class="w"> </span><span class="nb">Boolean</span><span class="p">,</span><span class="w">
  </span><span class="nv">$refundMethod</span><span class="p">:</span><span class="w"> </span><span class="n">OrderCancelRefundMethodInput</span><span class="p">!,</span><span class="w">
  </span><span class="nv">$restock</span><span class="p">:</span><span class="w"> </span><span class="nb">Boolean</span><span class="p">!,</span><span class="w">
  </span><span class="nv">$reason</span><span class="p">:</span><span class="w"> </span><span class="n">OrderCancelReason</span><span class="p">!,</span><span class="w">
  </span><span class="nv">$staffNote</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">orderCancel</span><span class="p">(</span><span class="w">
    </span><span class="n">orderId</span><span class="p">:</span><span class="w"> </span><span class="nv">$orderId</span><span class="p">,</span><span class="w">
    </span><span class="n">notifyCustomer</span><span class="p">:</span><span class="w"> </span><span class="nv">$notifyCustomer</span><span class="p">,</span><span class="w">
    </span><span class="n">refundMethod</span><span class="p">:</span><span class="w"> </span><span class="nv">$refundMethod</span><span class="p">,</span><span class="w">
    </span><span class="n">restock</span><span class="p">:</span><span class="w"> </span><span class="nv">$restock</span><span class="p">,</span><span class="w">
    </span><span class="n">reason</span><span class="p">:</span><span class="w"> </span><span class="nv">$reason</span><span class="p">,</span><span class="w">
    </span><span class="n">staffNote</span><span class="p">:</span><span class="w"> </span><span class="nv">$staffNote</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">userErrors</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="n">orderCancelUserErrors</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-graphql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">mutation</span><span class="w"> </span><span class="n">fulfillmentCancel</span><span class="p">(</span><span class="nv">$id</span><span class="p">:</span><span class="w"> </span><span class="nb">ID</span><span class="p">!)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">fulfillmentCancel</span><span class="p">(</span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nv">$id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">fulfillment</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="n">userErrors</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>Warranty/auxiliary products are identified by product tags that include <code class="language-plaintext highlighter-rouge">SEARCHANISE_IGNORE</code>.</li>
  <li>Throttling: brief waits between cancellation calls to avoid API rate limits.</li>
  <li>Notification: the Outlook node emails a summary to the operations mailbox.</li>
</ul>

<h2 id="outcomes">Outcomes</h2>

<ul>
  <li>Malicious warranty‑only orders are cancelled quickly and consistently, without blocking on fulfillment states.</li>
  <li>No more conflicts with Shopify High‑risk auto‑cancel flows.</li>
  <li>Lower manual review load for support and finance.</li>
</ul>


  </div>
  <footer class="post__footer">
    
      <div class="post__tags">
        <strong>Tags:</strong>
        <span class="tag">#shopify</span><span class="tag">#n8n</span><span class="tag">#automation</span><span class="tag">#graphql</span><span class="tag">#anti-fraud</span>
      </div>
    
    <nav class="post__pager">
      <a class="pager__prev" href="/Zinus/posts/2025/01/01/welcome-to-zinus-engineering/">← Welcome to the Zinus Engineering Blog</a>
      <a class="pager__next" href="/Zinus/posts/2025/09/05/keeping-outlook-mailboxes-lean-with-n8n/">Keeping Outlook Mailboxes Lean with n8n Our “Self-Cleaning Sent Items” Workflow →</a>
    </nav>
  </footer>
</article>



    </main>
    <footer class="site-footer">
  <div class="container footer__inner">
    <p>© 2025 Zinus, Inc. All rights reserved.</p>
    <ul class="social">
      
        <li><a href="https://github.com/zinus-inc" target="_blank" rel="noopener">GitHub</a></li>
      
      
        <li><a href="https://www.linkedin.com/company/zinus-inc/posts/?feedView=all" target="_blank" rel="noopener">LinkedIn</a></li>
      
      <li><a href="/Zinus/feed.xml">RSS</a></li>
    </ul>
  </div>
</footer>



  </body>
  </html>


